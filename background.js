(()=>{var r=typeof browser<"u"?browser:chrome,f={runtime:{onMessage:r.runtime.onMessage,sendMessage:(...t)=>r.runtime.sendMessage(...t),onInstalled:r.runtime.onInstalled},action:r.action||r.browserAction,tabs:r.tabs},i=f;var n=new Set;i.action.onClicked.addListener(async t=>{if(!t.id)return;let e=n.has(t.id);e?n.delete(t.id):n.add(t.id);try{await i.tabs.sendMessage(t.id,{type:"TOGGLE_VIMASCII",active:!e})}catch{n.delete(t.id)}});i.tabs.onRemoved?.addListener(t=>{n.delete(t)});i.runtime.onMessage.addListener((t,e,a)=>t.type==="GET_STATE"&&e.tab?(a({active:n.has(e.tab.id)}),!1):t.type==="ACTIVATE"&&e.tab?(n.add(e.tab.id),!1):t.type==="DEACTIVATE"&&e.tab?(n.delete(e.tab.id),!1):t.type==="FETCH_IMAGE"?(b(t.url).then(s=>{a({dataUrl:s})}).catch(()=>{a({dataUrl:null})}),!0):!1);async function b(t){if(!t||t.startsWith("data:")||t.startsWith("blob:"))return null;let e=await fetch(t,{credentials:"include"});if(!e.ok)return null;let a=e.headers.get("content-type")||"image/png";if(!a.startsWith("image/"))return null;let s=await e.arrayBuffer();if(s.byteLength===0)return null;let c=new Uint8Array(s),d="",l=8192;for(let o=0;o<c.length;o+=l){let u=c.subarray(o,o+l);d+=String.fromCharCode.apply(null,u)}return`data:${a};base64,${btoa(d)}`}})();
